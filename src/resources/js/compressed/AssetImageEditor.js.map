{"version":3,"file":"AssetImageEditor.js","sources":["../AssetImageEditor.js"],"names":["Craft","AssetImageEditor","Garnish","Modal","extend","$body","$tools","$buttons","$cancelBtn","$replaceBtn","$saveBtn","$editorContainer","$straighten","canvas","image","viewport","viewportMask","assetId","cacheBust","zoomRatio","croppingCanvas","clipper","cropper","croppingShade","tiltedImageVerticeCoords","lastValidCroppingCoordinates","lastValidCroppingScales","previousScreenX","previousScreenY","isCroppingPerformed","appliedFilter","appliedFilterOptions","editorHeight","editorWidth","viewportWidth","viewportHeight","imageAngle","imageStraightenAngle","viewportRotation","originalWidth","originalHeight","animationInProgress","init","settings","this","Date","now","setSettings","defaults","$container","$","appendTo","$bod","$footer","base","t","allowSavingAsNew","addListener","proxy","removeListener","$shade","postActionRequest","loadEditor","data","html","fabric","StaticCanvas","backgroundColor","hoverCursor","enableRetinaScaling","innerHeight","innerWidth","imageUrl","getActionUrl","size","assetSize","Image","fromURL","imageObject","getHeight","getWidth","_scaleAndCenterImage","getZoomToCoverRatio","_renewImageZoomRatio","_createViewportMask","width","height","top","left","Group","originX","originY","selectable","add","_addListeners","_drawGrid","_prepareImageForRotation","renderAll","Math","round","set","setDimensions","scale","dimensions","mask","Rect","fill","globalCompositeOperation","_callIfControlActive","callback","ev","isActiveControl","currentTarget","call","preventDefault","stopPropagation","bind","rotateViewport","resetStraighten","straighten","$option","find","addClass","val","removeClass","applyFilter","enableCropMode","cancelCropMode","applyCrop","degrees","discardCrop","parseInt","newAngle","getAngle","animate","onChange","duration","animationDuration","onComplete","cleanAngle","angle","type","hideGrid","showGrid","_destroyCropper","saveImage","$button","hasClass","append","postData","imageRotation","replace","filterHandle","filter","filterOptions","option","encodeURIComponent","end","remove","onSave","hide","parseFloat","angleInRadians","abs","PI","scaledWidth","sin","cos","scaledHeight","max","getZoomToFitRatio","proportion","strokeOptions","strokeWidth","gridLineThickness","opacity","stroke","gridLineColor","imageWidth","imageHeight","gridLines","Line","divideAndDraw","divisionLevel","dimensionToDivide","offset","lineLength","axis","divisionPoint","ceil","pointOptions","gridLinePrecision","push","grid","onFadeOut","destroy","$spinner","insertAfter","getParams","getSelectedFilter","getFilterOptions","JSON","stringify","setSrc","filterParams","$filterFields","each","$input","prop","$element","parents","length","showCropper","_switchEditingMode","mode","onFinish","hideCropper","skipAnimation","properties","cropperWidth","x","cropperHeight","y","cropperCenter","deltaX","deltaY","selector","scaleX","scaleY","_createCropper","setActiveObject","Canvas","selection","css","position","hasBorders","hasControls","lockRotation","combinedRatio","rectWidth","rectHeight","croppingGroup","rectangle","hasRotatingPoint","borderOpacityWhenMoving","cornerColor","transparentCorners","cornerSize","cornerStyle","_setTiltedVerticeCoordinates","onCropperChange","eventType","options","target","floor","topLeft","topRight","bottomRight","bottomLeft","fitsTheImage","arePointsInsideRectangle","bigEnough","minimumCropperSize","adjustedPosition","e","screenX","screenY","on","object:moving","object:scaling","topVerticalSegment","bottomVerticalSegment","rightHorizontalSegment","leftHorizontalSegment","verticalOffset","horizontalOffset","a","b","c","d","siblings","parent","before","points","getVector","scalarProduct","ab","bc","scalarAbAb","scalarBcBc","i","point","ap","bp","scalarAbAp","scalarBcBp","projectsOnAB","projectsOnBC","noop"],"mappings":"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"}