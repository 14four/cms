!function(a){Craft.RichTextInput=Garnish.Base.extend({id:null,entrySources:null,categorySources:null,assetSources:null,elementLocale:null,redactorConfig:null,$textarea:null,redactor:null,init:function(b,c,d,e,f,g,h){this.id=b,this.entrySources=c,this.categorySources=d,this.assetSources=e,this.elementLocale=f,this.redactorConfig=g,this.redactorConfig.lang=h,this.redactorConfig.direction=Craft.orientation,this.redactorConfig.imageUpload=!0;var i=this,j=g.initCallback;this.redactorConfig.initCallback=function(b,c){return i.redactor=this,i.onRedactorInit(),a.isFunction(j)?j.call(this,b,c):c},this.$textarea=a("#"+this.id),this.initRedactor(),"undefined"!=typeof Craft.livePreview&&(Craft.livePreview.on("beforeEnter beforeExit",a.proxy(function(){this.redactor.core.destroy()},this)),Craft.livePreview.on("enter slideOut",a.proxy(function(){this.initRedactor()},this)))},initRedactor:function(){this.$textarea.redactor(this.redactorConfig),this.redactor=this.$textarea.data("redactor")},onRedactorInit:function(){this.redactor.opts.toolbar&&this.customizeToolbar(),this.leaveFullscreetOnSaveShortcut()},customizeToolbar:function(){var b=this.replaceRedactorButton("image",Craft.t("Insert image")),c=this.replaceRedactorButton("link",Craft.t("Link"));if(b&&this.redactor.button.addCallback(b,a.proxy(function(){this.redactor.selection.save(),"undefined"==typeof this.assetSelectionModal?this.assetSelectionModal=Craft.createElementSelectorModal("Asset",{storageKey:"RichText.ChooseImage",multiSelect:!0,criteria:{locale:this.elementLocale,kind:"image"},onSelect:a.proxy(function(b,c){if(b.length){this.redactor.selection.restore();for(var d=0;d<b.length;d++){var e=b[d],f=e.url+"#asset:"+e.id;c&&(f+=":"+c),this.redactor.insert.node(a('<img src="'+f+'" />')[0]),this.redactor.code.sync()}this.redactor.observe.images(),this.redactor.dropdown.hideAll()}},this),closeOtherModals:!1,canSelectImageTransforms:!0}):this.assetSelectionModal.show()},this)),c){var d={};this.entrySources.length&&(d.link_entry={title:Craft.t("Link to an entry"),func:a.proxy(function(){this.redactor.selection.save(),"undefined"==typeof this.entrySelectionModal?this.entrySelectionModal=Craft.createElementSelectorModal("Entry",{storageKey:"RichText.LinkToEntry",sources:this.entrySources,criteria:{locale:this.elementLocale},onSelect:a.proxy(function(b){if(b.length){this.redactor.selection.restore();var c=b[0],d=c.url+"#entry:"+c.id,e=this.redactor.selection.getText(),f=e.length>0?e:c.label;this.redactor.insert.node(a('<a href="'+d+'">'+f+"</a>")[0]),this.redactor.code.sync()}this.redactor.dropdown.hideAll()},this),closeOtherModals:!1}):this.entrySelectionModal.show()},this)}),this.categorySources.length&&(d.link_category={title:Craft.t("Link to a category"),func:a.proxy(function(){this.redactor.selection.save(),"undefined"==typeof this.categorySelectionModal?this.categorySelectionModal=Craft.createElementSelectorModal("Category",{storageKey:"RichTextFieldType.LinkToCategory",sources:this.categorySources,criteria:{locale:this.elementLocale},onSelect:a.proxy(function(b){if(b.length){this.redactor.selection.restore();var c=b[0],d=c.url+"#category:"+c.id,e=this.redactor.selection.getText(),f=e.length>0?e:c.label;this.redactor.insert.node(a('<a href="'+d+'">'+f+"</a>")[0]),this.redactor.code.sync()}this.redactor.dropdown.hideAll()},this),closeOtherModals:!1}):this.categorySelectionModal.show()},this)}),this.assetSources.length&&(d.link_asset={title:Craft.t("Link to an asset"),func:a.proxy(function(){this.redactor.selection.save(),"undefined"==typeof this.assetLinkSelectionModal?this.assetLinkSelectionModal=Craft.createElementSelectorModal("Asset",{storageKey:"RichText.LinkToAsset",criteria:{locale:this.elementLocale},onSelect:a.proxy(function(b){if(b.length){this.redactor.selection.restore();var c=b[0],d=c.url+"#asset:"+c.id,e=this.redactor.selection.getText(),f=e.length>0?e:c.label;this.redactor.insert.node(a('<a href="'+d+'">'+f+"</a>")[0]),this.redactor.code.sync()}this.redactor.dropdown.hideAll()},this),closeOtherModals:!1,canSelectImageTransforms:!0}):this.assetLinkSelectionModal.show()},this)}),d.link={title:Craft.t("Insert link"),func:"link.show"},d.unlink={title:Craft.t("Unlink"),func:"link.unlink"},this.redactor.button.addDropdown(c,d)}},leaveFullscreetOnSaveShortcut:function(){"undefined"!=typeof this.redactor.fullscreen&&"function"==typeof this.redactor.fullscreen.disable&&Craft.cp.on("beforeSaveShortcut",a.proxy(function(){this.redactor.fullscreen.isOpen&&this.redactor.fullscreen.disable()},this))},replaceRedactorButton:function(a,b){if(this.redactor.button.get(a).length){var c=a+"_placeholder";this.redactor.button.addAfter(a,c),this.redactor.button.remove(a);var d=this.redactor.button.addAfter(c,a,b);return this.redactor.button.remove(c),d}}})}(jQuery);
//# sourceMappingURL=RichTextInput.js.map