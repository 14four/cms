!function(a){Craft.UpdateInfo=Garnish.Base.extend({appUpdateInfo:null,$container:null,$downloadBtn:null,licenseHud:null,$licenseSubmitBtn:null,licenseSubmitAction:null,allowAutoUpdates:null,init:function(b){this.allowAutoUpdates=b;var c=a("#graphic"),d=a("#status");Craft.postActionRequest("update/get-available-updates",a.proxy(function(b,e){if("success"!=e||b.error||b.errors){var f=Craft.t("An unknown error occurred.");b.errors&&b.errors.length?f=b.errors[0]:b.error&&(f=b.error),c.addClass("error"),d.text(f)}else{var g={total:b.app&&b.app.releases&&b.app.releases.length?1:0,critical:b.app&&b.criticalUpdateAvailable};g.total?(c.velocity("fadeOut",{duration:"fast"}),d.fadeOut("fast",a.proxy(function(){c.remove(),d.remove(),this.appUpdateInfo=b.app,this.showAvailableUpdates()},this))):(c.addClass("success"),d.text(Craft.t("You’re all up-to-date!"))),Craft.cp.displayUpdateInfo(g)}},this))},showAvailableUpdates:function(){this.$container=a("<div/>").appendTo(Craft.cp.$main).hide();var b,c=a('<div class="pane clearafter"/>').appendTo(this.$container),d=(a('<h2 class="heading">'+Craft.t("You’ve got updates!")+"</h2>").appendTo(c),a('<div class="buttons"/>').appendTo(c));if(!this.allowAutoUpdates||this.appUpdateInfo.manualUpdateRequired)this.$downloadBtn=a('<div class="btn submit">'+Craft.t("Download")+"</div>").appendTo(d);else{var e=a('<div class="btngroup submit"/>').appendTo(d);b=a('<div class="btn submit">'+Craft.t("Update")+"</div>").appendTo(e);var f=a('<div class="btn submit menubtn"/>').appendTo(e),g=a('<div class="menu" data-align="right"/>').appendTo(e),h=a("<ul/>").appendTo(g),i=a("<li/>").appendTo(h);this.$downloadBtn=a("<a>"+Craft.t("Download")+"</a>").appendTo(i),new Garnish.MenuBtn(f)}this.allowAutoUpdates&&(this.appUpdateInfo.licenseUpdated?(this.addListener(this.$downloadBtn,"click","showLicenseForm"),this.appUpdateInfo.manualUpdateRequired||this.addListener(b,"click","showLicenseForm")):(this.addListener(this.$downloadBtn,"click","downloadThat"),this.appUpdateInfo.manualUpdateRequired||this.addListener(b,"click","autoUpdateThat"))),this.showReleases(this.appUpdateInfo.releases,"Craft"),this.$container.velocity("fadeIn",{duration:"fast"})},showLicenseForm:function(b){if(b.stopPropagation(),this.licenseHud)this.licenseHud.$trigger=a(b.currentTarget),this.licenseHud.show();else{var c=a("<form><p>"+Craft.t('Craft’s <a href="http://buildwithcraft.com/license" target="_blank">Terms and Conditions</a> have changed.')+"</p></form>"),d=a("<label> "+Craft.t("I agree.")+" &nbsp;</label>").appendTo(c),e=a('<input type="checkbox"/>').prependTo(d);this.$licenseSubmitBtn=a('<input class="btn submit" type="submit"/>').appendTo(c),this.licenseHud=new Garnish.HUD(b.currentTarget,c),this.addListener(c,"submit",function(a){a.preventDefault(),e.prop("checked")?(this.licenseSubmitAction(),this.licenseHud.hide(),e.prop("checked",!1)):Garnish.shake(this.licenseHud.$hud)})}b.currentTarget==this.$downloadBtn[0]?(this.$licenseSubmitBtn.attr("value",Craft.t("Seriously, download.")),this.licenseSubmitAction=this.downloadThat):(this.$licenseSubmitBtn.attr("value",Craft.t("Seriously, update.")),this.licenseSubmitAction=this.autoUpdateThat)},showReleases:function(b,c){for(var d=0;d<b.length;d++){var e=a('<div class="pane release"/>').appendTo(this.$container),f=b[d],g=c+" "+f.version;f.build&&(g+=' <span class="light">'+Craft.t("build {build}",{build:f.build})+"</span>"),f.critical&&(g+=' <span class="critical">'+Craft.t("Critical")+"</span>"),a("<h2>"+g+"</h2>").appendTo(e),a('<div class="notes"/>').appendTo(e).html(f.notes)}},downloadThat:function(){var b=this.appUpdateInfo.manualDownloadEndpoint;"https:"==window.location.protocol&&(b=b.replace("http:","https:")),a("<iframe/>",{src:b}).appendTo(Garnish.$bod).hide()},autoUpdateThat:function(){window.location.href=Craft.getUrl("updates/go/craft")}})}(jQuery);
//# sourceMappingURL=updates.js.map