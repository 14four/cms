<div class="blockeditor" data-input-name="{:name}">

	<div class="list">
		<h3>Content Blocks</h3>
		<ul>
			{foreach currentBlocks as block}
				<li><a class="block-item {if block.errors}error{/if}" data-block-id="{:block.id}">
					<div class="name {if block.required}required{/if}">{if block.name}{:block.name}{else}Untitled{/if}</div>
					<div class="type">{:block.blocktypeName}</div>
					<input type="hidden" name="{:name}[order][]" value="{:block.id}"/>
				</a></li>
			{/foreach}
		</ul>
		<a class="btn light addbtn new-block">New content block</a>
	</div>

	<div class="settings">
		{foreach currentBlocks as block}
			<?php $idPrefix = new Variable($name.'-'.$block->id().'-') ?>
			<?php $namePrefix = new Variable($name.'['.$block->id().']') ?>
			<div data-block-id="{:block.id}" style="display:none">
				{include "_includes/blockeditor/blocksettings" idPrefix=idPrefix namePrefix=namePrefix block=block}
			</div>
		{/foreach}
	</div>

	<?php $newIdPrefix = new Variable($name.'-BLOCK_ID-') ?>
	<?php $newNamePrefix = new Variable($name.'[BLOCK_ID]') ?>

	<div class="freshblocksettings" style="display:none">
		<div class="blockeditor-settings" data-block-id="BLOCK_ID">
			{include "_includes/blockeditor/blocksettings" idPrefix=newIdPrefix namePrefix=newNamePrefix}
		</div>
	</div>

	<div class="freshblocktypesettings" style="display:none">
		<?php $newNamePrefix = new Variable($newNamePrefix.'[settings]') ?>
		{foreach b.contentblocks.blocktypes as blocktype}
			{set settings = blocktype.displaySettings(newIdPrefix, newNamePrefix)}
			{if settings}
				<div data-blocktype-class="{:blocktype.classHandle}">
					<div class="{:blocktype.classHandle} nested-pane-items">
						<div></div>
						{:settings}
					</div>
				</div>
			{/if}
		{/foreach}
	</div>

</div>
