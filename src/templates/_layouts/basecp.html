{% extends "_layouts/base" %}

{# Give the body a .mobile class for mobile devices #}
{% if craft.request.getIsMobileBrowser(true) %}
	{% set bodyClass = (bodyClass is defined and bodyClass ? bodyClass~' ' : '') ~ 'mobile' %}
{% endif %}

{% includeTranslations "Show", "Hide" %}

{% set localeData = craft.i18n.getLocaleData() %}
{% set orientation = localeData.getOrientation() %}

{% block foot %}
	<noscript>
		<div class="message-container no-access">
			<div class="pane notice">
				<p>{{ "JavaScript must be enabled to access the Craft control panel."|t('app') }}</p>
			</div>
		</div>
	</noscript>

	{% registerjs at head %}
		// Create the Craft object
		window.Craft = {
			siteUid:               "{{ craft.app.getSiteUid()|e('js') }}",
			baseUrl:               "{{ url()|e('js') }}",
			baseCpUrl:             "{{ cpUrl()|e('js') }}",
			baseSiteUrl:           "{{ siteUrl()|e('js') }}",
			actionUrl:             "{{ actionUrl()|e('js') }}",
			resourceUrl:           "{{ resourceUrl()|e('js') }}",
			scriptName:            "{{ craft.request.getScriptName()|e('js') }}",
			omitScriptNameInUrls:  {{ craft.config.omitScriptNameInUrls() ? 'true' : 'false' }},
			usePathInfo:           {{ craft.config.usePathInfo() ? 'true' : 'false' }},
			useCompressedJs:       {{ craft.config.useCompressedJs ? 'true' : 'false' }},
			resourceTrigger:       "{{ craft.config.getResourceTrigger()|e('js') }}",
			actionTrigger:         "{{ craft.config.actionTrigger|e('js') }}",
			path:                  "{{ craft.request.getPath()|e('js') }}",
			locale:                "{{ craft.locale|e('js') }}",
			orientation:           "{{ orientation|e('js') }}",
			left:                  "{{ orientation == 'ltr' ? 'left' : 'right' }}",
			right:                 "{{ orientation == 'ltr' ? 'right' : 'left' }}",
			datepickerFormat:      "{{ craft.i18n.getDatepickerJsFormat()|e('js') }}",
			username:              {{ currentUser is defined and currentUser ? ('"'~currentUser.username|e('js')~'"')|raw : 'null' }},
			remainingSessionTime:  {{ craft.request.getFirstSegment() not in ['updates', 'manualupdate'] ? craft.session.getRemainingSessionTime : 0 }},
			Personal:              {{ CraftPersonal }},
			Client:                {{ CraftClient }},
			Pro:                   {{ CraftPro }},
			edition:               {{ CraftEdition }},
			isLocalized:           {{ craft.isLocalized() ? 'true' : 'false' }},
			translations:          {{ getTranslations()|raw }},
			maxUploadSize:         {{ craft.io.getMaxUploadSize() }},
			forceConfirmUnload:    {{ forceConfirmUnload is defined and forceConfirmUnload ? 'true' : 'false' }},
			{% if craft.config.enableCsrfProtection %}
				csrfTokenValue:        "{{ craft.request.getCsrfToken()|e('js') }}",
				csrfTokenName:         "{{ craft.config.csrfTokenName|e('js') }}",
			{% endif %}
			runTasksAutomatically: {{ craft.config.runTasksAutomatically ? 'true' : 'false' }},
			slugWordSeparator:     "{{ craft.config.slugWordSeparator|e('js') }}",
			limitAutoSlugsToAscii: {{ craft.config.limitAutoSlugsToAscii ? 'true' : 'false' }},
			fileKinds:             {{ craft.io.getFileKinds()|json_encode|raw }},
			datepickerOptions: {
				constrainInput: false,
				dateFormat: "{{ craft.i18n.getDatepickerJsFormat()|e('js') }}",
				prevText: '{{ "Prev"|t|e('js') }}',
				nextText: '{{ "Next"|t|e('js') }}',
				firstDay: {{ currentUser.getPreference('weekStartDay') ?? craft.config.defaultWeekStartDay }},
				dayNames: {{ localeData.getWeekDayNames('wide', true)|json_encode|raw }},
				dayNamesShort: {{ localeData.getWeekDayNames('abbreviated', true)|json_encode|raw }},
				dayNamesMin: {{ localeData.getWeekDayNames('narrow', true)|json_encode|raw }},
				monthNames: {{ localeData.getMonthNames('wide', true)|values|json_encode|raw }},
				monthNamesShort: {{ localeData.getMonthNames('abbreviated', true)|values|json_encode|raw }}
			},
			publishableSections: [
				{% if isInstalled and currentUser is defined and currentUser %}
					{% for section in craft.sections.getEditableSections() %}
						{% if section.type != 'single' and currentUser.can('createEntries:'~section.id) %}
							{id: {{ section.id }}, name: "{{ section.name|t|e('js') }}", handle: "{{ section.handle|e('js') }}", type: "{{ section.type }}"}{% if not loop.last %},{% endif %}
						{% endif %}
					{% endfor %}
				{% endif %}
			],
			editableCategoryGroups: [
				{% if isInstalled %}
					{% for group in craft.categoryGroups.getEditableGroups() %}
						{id: {{ group.id }}, name: "{{ group.name|t|e('js') }}", handle: "{{ group.handle|e('js') }}"}{% if not loop.last %},{% endif %}
					{% endfor %}
				{% endif %}
			]
		};

		// Picture element HTML5 shiv
		document.createElement('picture');
	{% endregisterjs %}
{% endblock %}
