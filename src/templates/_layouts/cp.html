{% extends "_layouts/basecp" %}

{% includeCssResource "css/cp.css" first %}
{% includeTranslations
	"(blank)",
	"1 update available",
	"Actions",
	"An unknown error occurred.",
	"Any changes will be lost if you leave this page.",
	"Are you sure you want to delete the selected blocks?",
	"Are you sure you want to delete “{name}”?",
	"Are you sure you want to transfer your license to this domain?",
	"Cancel",
	"Choose a user",
	"Close",
	"Continue",
	"Couldn’t delete “{name}”.",
	"Couldn’t save new order.",
	"Create",
	"day",
	"days",
	"Delete folder",
	"Delete it",
	"Delete user",
	"Delete users",
	"Delete",
	"Display as thumbnails",
	"Display in a table",
	"Done",
	"Enter the name of the folder",
	"Enter your password to log back in.",
	"Failed task",
	"Failed",
	"Handle",
	"Hide sidebar",
	"hour",
	"hours",
	"Instructions",
	"Keep me logged in",
	"License transferred.",
	"Log out now",
	"Login",
	"minute",
	"minutes",
	"More",
	"Move",
	"Name",
	"New category",
	"New child",
	"New entry",
	"New order saved.",
	"New position saved.",
	"New subfolder",
	"New {group} category",
	"New {section} entry",
	"Options",
	"Password",
	"Pending",
	"Really delete folder “{folder}”?",
	"Remove",
	"Rename folder",
	"Reorder",
	"Save",
	"Score",
	"Search in subfolders",
	"second",
	"seconds",
	"Select transform",
	"Select",
	"Settings",
	"Show sidebar",
	"Show/hide children",
	"Sort by {attribute}",
	"Structure",
	"Transfer it to:",
	"Try again",
	"Upload failed for {filename}",
	"Upload files",
	"week",
	"weeks",
	"What do you want to do with their content?",
	"Your session has ended.",
	"Your session will expire in {time}.",
	"{ctrl}C to copy.",
	"{num} updates available",
	"“{name}” deleted."
%}

{% set forceConfirmUnload = craft.session.hasFlash('error') %}

{% set devMode = currentUser.admin and craft.config.devMode %}
{% if devMode %}
	{% set bodyClass = (bodyClass is defined and bodyClass ? bodyClass ~ ' ' : '') ~ 'dev-mode' %}
{% endif %}


{% block body %}
	{% if craft.cp.areAlertsCached() %}
		{% set alerts = craft.cp.getAlerts() %}
		{% if alerts %}
			<ul id="alerts">
				{% for alert in craft.cp.getAlerts() %}
					<li>{{ alert|raw }}</li>
				{% endfor %}
			</ul>
		{% endif %}
	{% else %}
		{% includeJs 'Craft.cp.fetchAlerts();' %}
	{% endif %}

	<header id="global-sidebar">

		<div class="topbar">
			<ul id="header-actions">
				{% set task = craft.tasks.getRunningTask() %}
				{% if task %}
					{% includeJs 'Craft.cp.setRunningTaskInfo('~task.getInfo()|json_encode|raw~');' %}
					{% includeJs 'Craft.cp.trackTaskProgress();' %}
				{% elseif craft.tasks.areTasksPending() %}
					{% includeJs 'Craft.cp.runPendingTasks();' %}
				{% elseif craft.tasks.haveTasksFailed() %}
					{% includeJs 'Craft.cp.setRunningTaskInfo({ status: "error" });' %}
				{% endif %}

				{% if currentUser.can('performUpdates') %}
					{% if craft.app.isUpdateInfoCached() %}
						{% set totalUpdates = craft.app.getTotalAvailableUpdates() %}
						{% if totalUpdates %}
							{% if totalUpdates == 1 %}
								{% set updateText = "1 update available"|t %}
							{% else %}
								{% set updateText = "{num} updates available"|t({ num: totalUpdates }) %}
							{% endif %}
							<li class="updates{% if craft.app.isCriticalUpdateAvailable() %} critical{% endif %}">
								<a data-icon="newstamp" href="{{ url('updates') }}" title="{{ updateText }}">
									<span>{{ totalUpdates }}</span>
								</a>
							</li>
						{% endif %}
					{% else %}
						{% includeJs 'Craft.cp.checkForUpdates();' %}
					{% endif %}
				{% endif %}

				{#
					{% if currentUser.admin %}
					<li>
						<a class="settings" data-icon="settings" href="{{ url('settings') }}" title="{{ 'Settings'|t }}"></a>
					</li>
					<li>
						<a class="settingsmenu menubtn" title="{{ 'Settings'|t }}"></a>
						<div id="settingsmenu" class="menu" data-align="right">
							{% for category, items in craft.cp.settings() %}
								<h6>{{ category }}</h6>
								<ul class="padded">
									{% for handle, item in items %}
										<li>
											<a href="{% if item.url is defined %}{{ url(item.url) }}{% else %}{{ url('settings/'~handle) }}{% endif %}" {% if item.icon is defined %}data-icon="{{ item.icon }}"{% endif %}>

												{% if item.iconUrl is defined %}
													<img src="{{ item.iconUrl }}" />
												{% endif %}

												{{ item.label }}
											</a>
										</li>
									{% endfor %}
								</ul>
							{% endfor %}
						</div>
					</li>
				{% endif %}
				#}

				<li>
					<a data-icon="user" class="myaccount menubtn" title="{{ 'My Account'|t }}" role="button"></a>
					<div class="menu" data-align="right">
						<ul>
							<li><a href="{{ url('myaccount') }}">{{ "My Account"|t }}</a></li>
							{% if CraftEdition == CraftClient and currentUser.admin %}
								<li><a href="{{ url('clientaccount') }}">{{ "Client’s Account"|t }}</a></li>
							{% endif %}
							<li><a href="{{ logoutUrl }}">{{ "Sign out"|t }}</a></li>
						</ul>
					</div>
				</li>
			</ul>

			<h2><a href="{{ siteUrl }}" title="{{ 'Site Homepage'|t }}" target="_blank">{{ siteName|t }}</a></h2>
		</div>

		<nav>
			<ul id="nav">

				{% for handle, item in craft.cp.nav() %}

					{% set hasSubnav = (subnav is defined and subnav) %}

					<li id="nav-{{ handle }}"{% if item.sel and hasSubnav %} class="has-subnav"{% endif %}>
						<a{% if item.sel %} class="sel"{% endif %} href="{{ item.url }}">
							<span class="icon">
								{%- if item.icon is defined -%}
									<span data-icon="{{ item.icon }}"></span>
								{%- elseif item.iconSvg is defined and item.iconSvg -%}
									{{ item.iconSvg|raw }}
								{%- else -%}
									<svg version="1.1" baseProfile="full" width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
										<circle cx="10" cy="10" r="10" fill="#fff" fill-opacity="0.35"/>
										<text x="10" y="15" font-size="15" font-family="sans-serif" font-weight="bold" text-anchor="middle" fill="#fff">{{ item.label[0:1]|upper }}</text>
									</svg>
								{%- endif -%}
							</span>

							<span class="label">
								{{- item.label -}}
							</span>

							{%- if item.badge is defined and item.badge -%}
								<span class="badge">{{ item.badge }}</span>
							{%- endif -%}
						</a>

						{% if item.sel and hasSubnav  %}
				            <ul class="subnav">
				                {% for itemId, item in subnav %}
				                    {% set itemIsSelected = (
				                        (selectedSubnavItem is defined and selectedSubnavItem == itemId) or
				                        (selectedSubnavItem is not defined and loop.first)
				                    ) -%}

				                    <li>
				                    	<a href="{{ url(item.url) }}"{% if itemIsSelected %} class="sel"{% endif %}>{{ item.label }}</a>
				                    </li>

				                {% endfor %}
				            </ul>
						{% endif %}

					</li>
				{% endfor %}

				{#
				<!-- HIDE -->
				<li id="customize-nav-btn"><a class="settings icon" title="{{ 'Customize…'|t }}"><span>{{ "Customize…"|t }}</span></a></li>
				<!-- end HIDE -->
				#}
			</ul>
		</nav>
	</header>

	<div id="container">
		<div id="notifications-wrapper">
			<div id="notifications">
				{% for type in ['notice', 'error'] %}
					{% set message = craft.session.getFlash(type) %}
					{% if message %}
						<div class="notification {{ type }}">{{ message }}</div>
					{% endif %}
				{% endfor %}
			</div>
		</div>

		<div class="topbar">
			{% if crumbs is defined and crumbs %}
				<nav id="crumbs">
					<ul>
						{% for crumb in crumbs %}
							<li><a href="{{ crumb.url }}">{{ crumb.label }}</a></li>
						{% endfor %}
					</ul>
				</nav>
			{% endif %}
		</div>

		<header id="page-header">
			{% block pageHeader %}

				{% if title is defined and title %}
					<h1>{{ title }}</h1>
				{% endif %}

				{% if extraPageHeaderHtml is defined %}
					<div id="extra-headers">
						{{ extraPageHeaderHtml }}
					</div>
				{% endif %}

				<div class="clear"></div>
			{% endblock %}
		</header>

		{# Is the template defining its own layout? #}
		{% set main = block('main')|trim %}
		{% set hasCustomLayout = (main is not empty) %}

		<main id="main" role="main"{% if not hasCustomLayout %} class="single-pane"{% endif %}>
			{% if hasCustomLayout %}
				{{ main|raw }}
			{% else %}
				{% set sidebar = sidebar is defined ? sidebar : block('sidebar')|trim %}
				{% set hasSidebar = (sidebar is not empty) %}
				{% set hasHelp = (docsUrl is defined and docsUrl is not empty) %}

				<div class="pane">
					{% if tabs is defined and tabs %}
						{% include "_includes/tabs" %}
					{% endif %}

					<div id="content" class="content{% if hasSidebar %} has-sidebar{% endif %}{% if hasHelp %} has-help{% endif %}">
						{% if hasSidebar %}
							<div id="sidebar" class="sidebar">
								{{ sidebar|raw }}
							</div>
						{% endif %}

						<div class="body">
							{% block content %}
								{{ content is defined ? content }}
							{% endblock %}
						</div>

						{% if hasHelp %}
							<a id="help" class="help" title="{{ 'Help'|t }}" href="{{ docsUrl }}" target="_blank"></a>
						{% endif %}
					</div>
				</div>
			{% endif %}
		</main>

		<div id="footer">
			<ul>
				<li>@@@appName@@@ {{ craft.app.getEditionName()}} {{ craft.app.getVersion() }}.{{ craft.app.getBuild() }}</li>
				<li>{{ "Released on"|t }} {{ craft.app.releaseDate.localeDate }}</li>
				{% if currentUser.can('performUpdates') %}
					<li><a id="footer-updates" href="{{ url('updates') }}">{{ craft.app.isUpdateInfoCached() and totalUpdates ? updateText : "Check for updates"|t }}</a></li>
				{% endif %}
				<li>{{ "Copyright"|t }} {{ now.year}} Pixel &amp; Tonic, Inc. {{ "All rights reserved."|t }}</li>
			</ul>

			{% if (CraftEdition == CraftPersonal or craft.request.getPath == 'settings') and craft.app.canUpgradeEdition() %}
				<p id="upgradepromo"><a>{{ "Upgrade Craft to take your site to the next level."|t }} <span class="go nowrap">{{ "Show me"|t }}</span></a></p>
			{% endif %}
		</div>
	</div>

	{% if currentUser.admin and craft.config.devMode %}
		<div id="devmode" title="{{ '@@@appName@@@ is running in Dev Mode.'|t }}"></div>
	{% endif %}

	{% if craft.app.hasWrongEdition() %}
		<div id="wrongedition-modal" class="modal fitted hidden">
			<div class="body">
				<p>{{ "You’re running Craft {edition} with a Craft {licensedEdition} license."|t({ edition: craft.app.getEditionName(), licensedEdition: craft.app.getLicensedEditionName() }) }}</p>
				<p>{{ "What would you like to do?"|t }}</p>
				<div class="buttons">
					<div class="btngroup">
						<div id="wrongedition-switchbtn" class="btn">{{ "Switch to Craft {edition}"|t({ edition: craft.app.getLicensedEditionName() }) }}</div>
						{% if craft.app.getEdition() > craft.app.getLicensedEdition() %}
							<div id="wrongedition-upgradebtn" class="btn">{{ "Upgrade your license"|t }}</div>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	{% endif %}
{% endblock %}
