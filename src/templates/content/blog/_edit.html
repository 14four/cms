{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}


{% if not entry and entryId %}
	{% set entry = blx.content.getEntryById(entryId) %}
	{% if not entry %}{% exit 404 %}{% endif %}
{% endif %}


{% if entry.id %}
	{% set title = "Editing {title}"|t({ title: '<i>'~entry.title|t~'</i>' }) %}
{% else %}
	{% set title = "Create a new entry"|t %}
{% endif %}


{% set titlebar %}
	<h1>{{ title|raw }}</h1>
	<ul class="left">
		<li><a href="{{ url('content') }}" class="btn backbtn">{{ "Content"|t }}</a></li>
	</ul>
{% endset %}


{% set content %}
	<form method="post" action="" class="centered">
		<input type="hidden" name="action" value="content/saveEntry">
		{% if entry.id %}<input type="hidden" name="entryId" value="{{ entry.id }}">{% endif %}

		{{ forms.textField({
			label: "Title"|t,
			id: 'title',
			name: 'title',
			value: entry.content.title,
			errors: entry.content.errors.title,
			first: true,
			required: true
		}) }}

		{{ forms.textField({
			label: "Slug"|t,
			id: 'slug',
			name: 'slug',
			value: entry.slug,
			errors: entry.errors.slug,
			required: true
		}) }}

		{% for block in blx.content.entryBlocks %}
			{% set data = entry.content[block.record.handle] %}
			{{ forms.field({
				label: block.record.name,
				instructions: block.record.instructions,
				id: block.record.handle,
				name: block.record.handle
			}, block.input(data)) }}
		{% endfor %}

		<div class="buttons">
			<input type="submit" class="btn submit" value="{{ 'Save'|t }}">
		</div>
	</form>
{% endset %}


{% set scripts %}
	<script type="text/javascript">
		{% if not section.handle %}new Blocks.ui.HandleGenerator('#name', '#handle');{% endif %}
		{% if not section.urlFormat %}new Blocks.ui.EntryUrlFormatGenerator('#name', '#urlFormat');{% endif %}
	</script>
{% endset %}
