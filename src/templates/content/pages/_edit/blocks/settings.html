{% extends "_layouts/cp" %}


{% if pageId is not defined %}{% exit 404 %}{% endif %}
{% set page = blx.pages.getPageById(pageId) %}
{% if not page %}{% exit 404 %}{% endif %}


{% set crumbs = [
	{ label: "Content"|t, url: url('content') },
	{ label: "Pages"|t, url: url('content/pages') },
	{ label: page.title|t, url: url('content/pages/'~page.id) },
	{ label: "Blocks"|t, url: url('content/pages/'~page.id~'/blocks') },
] %}


{% if block is not defined and blockId is defined %}
	{% set block = blx.pages.getBlockById(blockId) %}
	{% if not block %}{% exit 404 %}{% endif %}
{% endif %}


{% set isNewBlock = (block is not defined or not block.id) %}


{% if isNewBlock %}
	{% set title = "Create a new page block"|t %}
{% else %}
	{% set title = block.name|t %}
{% endif %}


{% set header %}
	<h1>{{ title|raw }}</h1>
	<ul class="left">
		<li><a href="{{ url('content/pages/' ~ page.id ~ '/blocks') }}" class="backbtn">{{ page.title|t }}</a></li>
	</ul>
{% endset %}


{% set content %}
	<form method="post" action="" accept-charset="UTF-8">
		<input type="hidden" name="action" value="pages/saveBlock">
		<input type="hidden" name="redirect" value="content/pages/{{ page.id }}/blocks">
		<input type="hidden" name="pageId" value="{{ page.id }}">
		{% if not isNewBlock %}<input type="hidden" name="blockId" value="{{ block.id }}">{% endif %}

		{% include "_includes/blocksettings" with { block: (block is defined ? block : null), canBeTranslatable: true } only %}

		<div class="buttons">
			<input type="submit" class="btn submit" value="{{ 'Save'|t }}">
		</div>
	</form>
{% endset %}
