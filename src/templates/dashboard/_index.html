{% extends "_layouts/cp" %}
{% set title = "Dashboard"|t %}
{% includeJsResource 'js/Dashboard.js' %}
{% includeCssResource "css/dashboard.css" %}

{% set extraPageHeaderHtml %}
	<div class="buttons secondary-buttons">
		<div class="newwidget btngroup submit">
			<div id="newwidgetmenubtn" class="btn submit menubtn add icon">{{ 'New widget'|t }}</div>
			<div class="menu newwidgetmenu">
				<ul>
					{% for widgetType in widgetTypes %}
						<li><a data-type="{{ widgetType.type }}" data-colspan="{{ widgetType.colspan }}" data-settings-html="{{ widgetType.settingsHtml }}" data-settings-js="{{ widgetType.settingsJs }}"><img src="{% if widgetType.iconUrl %}{{ widgetType.iconUrl }}{% else %}{{ resourceUrl('images/widgets/default.svg') }}{% endif %}" /> {{ widgetType.name }}</a></li>
					{% endfor %}
				</ul>
			</div>
		</div>

		<div id="widgetManagerBtn" class="btn settings icon submit" title="{{ 'Settings'|t }}"></div>
	</div>
{% endset %}


{% block main %}
	<div class="grid">
		{% if currentUser.admin and craft.deprecator.getTotalLogs() %}
			<div class="item" data-colspan="4">
				<div class="pane">
					<p id="deprecationnotice" data-icon="alert">{{ 'New deprecation errors have been logged. Please take a minute to <a class="go" href="{url}">review them</a>'|t({ url: url('utils/deprecationerrors') })|raw }}</p>
				</div>
			</div>
		{% endif %}

		{% for widget in widgets %}
			<div class="item" data-colspan="{{ widget.colspan }}">
				<div id="widget{{ widget.id }}" class="widget {{ widget.type|lower }}" data-id="{{ widget.id }}" data-name="{{ widget.name }}" data-title="{{ widget.title }}" data-icon-url="{{ widget.iconUrl }}" data-colspan="{{ widget.colspan }}" data-max-colspan="{{ widget.maxColspan }}">
					<div class="front">
						<div class="pane">
							<div class="spinner body-loading"></div>
							<div class="settings icon hidden"></div>
							<h2>{{ widget.title }}</h2>
							<div class="body">
								{{ widget.bodyHtml|raw }}
							</div>
						</div>
					</div>
					<div class="back">
						<form class="pane">
							<input type="hidden" name="widgetId" value="{{ widget.id }}">
							<h2>{{ "{type} Settings"|t({ type: widget.name }) }}</h2>
							<div class="settings"></div>
							<hr>
							<div class="buttons clearafter">
								<input type="submit" class="btn submit" value="{{ 'Save'|t }}">
								<div class="btn" role="button">{{ 'Cancel'|t }}</div>
								<div class="spinner hidden"></div>
							</div>
						</form>
					</div>
				</div>
			</div>
		{% endfor %}
	</div>
{% endblock %}
