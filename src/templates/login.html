{% if blx.session.loggedin %}
	{% redirect "dashboard" %}
{% endif %}

{% extends "_basic" %}
{% import "_includes/forms" as forms %}
{% set title = "Login"|t %}
{% includeCssResource "css/login.css" %}
{% includeJsResource "js/login.js" %}
{% includeTranslations
	"Reset Password",
	"Weâ€™ve sent you an email with instructions to reset your password."
%}

{% set body %}
	<script type="text/javascript">
		var cookie = 'BlocksCookieTest='+Math.floor(Math.random() * 1000000);
		document.cookie = cookie;
		var cookiesEnabled = document.cookie.search(cookie) != -1;
		if (cookiesEnabled)
		{
			document.write(
				'<form id="login-form" method="post" action="">' +
					'{{ forms.textField({ id: "username", hint: "Username or Email"|t, value: blx.session.rememberedusername })|e("js") }}' +

					'<div id="login-fields" class="nested-fields">' +
						'{{ forms.passwordField({ id: "password", hint: "Password"|t })|e("js") }}' +
						'{{ forms.checkboxField({ id: "remember-me", label: "Keep me logged in"|t })|e("js") }}' +
					'</div>' +

					'<div class="buttons">' +
						'<div id="submit" class="btn submit disabled" data-icon="{{ blx.request.secure ? '`' : '~' }}">' +
							'<span class="label">{{ "Login"|t }}</span>' +
							'<input type="submit">' +
						'</div>' +
						'<div id="spinner" class="spinner" style="display: none;"></div>' +
					'</div>' +
				'</form>'
			);

			var id = {% if blx.session.rememberedusername %}'password'{% else %}'username'{% endif %};
			document.getElementById(id).focus();
		}
		else
		{
			document.write(
				'<div class="no-access">' +
					'<div class="pane">' +
						'<div class="pane-body">' +
							'<div class="notice">' +
								'<div class="icon"></div>' +
								'<p>{{ "Cookies must be enabled to access the Blocks CP."|t }}<br>' +
									'<a class="go" href="">{{ "See how"|t }}</a>' +
								'</p>' +
							'</div>' +
						'</div>' +
					'</div>' +
				'</div>'
			);
		}
	</script>
{% endset %}
