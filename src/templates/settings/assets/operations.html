{% extends "settings/assets/_layout" %}
{% set selectedTab = 'operations' %}
{% import "_includes/forms" as forms %}
{% set sources = craft.assets.getAllSources %}

{% includeTranslations
	"The following items were found in the database that do not have a physical match.",
	"Folders",
	"Files",
	"Cancel",
	"Delete"
%}

{% set content %}
	<p id="nosources" {% if sources|length %}style="display: none"{% endif %}>
		{{ "No sources exist yet."|t }}
	</p>

	{% if sources|length %}

		{% if transformationHandle is defined %}
			{% set transformationValue = transformationHandle %}
		{% else %}
			{% set transformationValue = 0 %}
		{% endif %}

		{{ forms.checkboxSelectField({
			first: true,
			label: "Sources"|t,
			instructions: "Which asset sources do you want to perform operations on?"|t,
			id: 'sourceId',
			name: 'sourceId',
			options: sources,
			values: '',
			class: "assets-sources"
		}) }}

		{% set operationsField %}
			<ul>
				<li>
					{{ forms.checkbox({
						label: "Update indexes"|t,
						id: 'do-index',
						name: 'do-index',
						class: 'assets-index',
					}) }}
				</li>

				{% set transformations = craft.assets.getAllAssetTransformations() %}
				{% if transformations|length %}
					{% set transformationsChecked = (craft.request.getQuery('transformation') is not empty) %}
					<li>
						{{ forms.checkbox({
							label: "Update transformations"|t,
							id: 'do-transformations',
							name: 'do-transformations',
							class: 'assets-transformations',
							checked: transformationsChecked,
							toggle: 'transformations'
						}) }}
						<ul id="transformations" class="indent{% if not transformationsChecked %} hidden{% endif %} checkbox-select">
							<li>
								{{ forms.checkbox({
									class: 'all',
									label: '<b>' ~ "All"|t ~ '</b>',
									checked: (not transformationsChecked)
								}) }}
							</li>
							{% for transformation in transformations %}
								<li>
									{{ forms.checkbox({
										label: transformation.name,
										name: transformation ~ '[]',
										value: transformation.handle,
										checked: (not transformationsChecked or (transformationsChecked and craft.request.getQuery('transformation') == transformation.handle)),
										disabled: (not transformationsChecked)
									}) }}
								</li>
							{% endfor %}
						</ul>
					</li>
				{% endif %}
			</ul>
		{% endset %}

		{{ forms.field({
			label: "Operations"|t,
			instructions: "Which operations do you want to perform on the selected sources?"
		}, operationsField) }}

		<div class="operation-progress"></div>

		<div class="buttons">
			<div class="btn submit" id="start-operations">{{ "Start"|t }}</a>
		</div>

		{% includeJsResource "js/Assets/AssetOperations.js" %}
		{% includeJsResource "js/QueueManager.js" %}

	{% endif %}

{% endset %}
