{% layout "settings/_layouts/settings" pageTitle="System Info" %}

{% if !emailSettings %}
	{% set emailSettings = email.emailSettings %}
{% endif %}

{% region "main" %}
	<form method="post" action="">
		<input type="hidden" name="action" value="settings/saveemailsettings" />

		<div id="email-settings" class="pane">
			<div class="head">
				<h5>Email Settings</h5>
			</div>
			<div class="body">
				<div class="item field">
					<label for="emailAddress">System Email Address</label>
					<p>This is the email address Blocks will use when sending email.</p>
					<div class="input-wrapper"><input id="emailAddress" name="emailAddress" type="text" value="{emailSettings.emailAddress}" /></div>
					{% if emailSettings.errors.emailAddress %}
						{% include "_includes/error_list" errors=emailSettings.errors.emailAddress %}
					{% endif %}
				</div>
				<div class="item field">
					<label for="senderName">Sender Name</label>
					<p>This is the “From” name Blocks will use when sending email.</p>
					<div class="input-wrapper"><input id="senderName" name="senderName" type="text" value="{emailSettings.senderName}" /></div>
					{% if emailSettings.errors.senderName %}
						{% include "_includes/error_list" errors=emailSettings.errors.senderName %}
					{% endif %}
				</div>
				<div class="item field">
					<label for="protocol">Email Protocol</label>
					<p>This is the protocol Blocks will use to send email.</p>
					<div>
						<select id="protocol" name="protocol">
							<option value="PhpMail" {% if emailSettings.protocol == 'PhpMail' %}selected{% endif %}>PHP Mail</option>
							<option value="Sendmail" {% if emailSettings.protocol == 'Sendmail' %}selected{% endif %}>Sendmail</option>
							<option value="Smtp" {% if emailSettings.protocol == 'Smtp' %}selected{% endif %}>SMTP</option>
							<option value="GmailSmtp" {% if emailSettings.protocol == 'GmailSmtp' %}selected{% endif %}>Gmail SMTP</option>
							<option value="Pop" {% if emailSettings.protocol == 'Pop' %}selected{% endif %}>POP before SMTP</option>
						</select>
					</div>
				</div>
			</div>
		</div>

		<div id="hidden-fields" style="display: none">
			<div id="username-field" class="item field">
				<label for="username">Username</label>
				<div class="input-wrapper"><input id="username" name="username" type="text" value="{emailSettings.username}" /></div>
				{% if emailSettings.protocol != 'Smtp' && emailSettings.errors.username %}
					{% include "_includes/error_list" errors=emailSettings.errors.username %}
				{% endif %}
			</div>
			<div id="password-field" class="item field">
				<label for="password">Password</label>
				<div class="input-wrapper password"><input id="password" class="password" name="password" type="password" value="{emailSettings.password}" /></div>
				{% if emailSettings.protocol != 'Smtp' && emailSettings.errors.password %}
					{% include "_includes/error_list" errors=emailSettings.errors.password %}
				{% endif %}
			</div>
			
			<div id="port-field" class="item field">
				<label for="port">Port</label>
				<input id="port" name="port" class="input" type="text" value="{% if emailSettings.port %}{emailSettings.port}{% else %}25{% endif %}" size="5" />
				{% if emailSettings.errors.port %}
					{% include "_includes/error_list" errors=emailSettings.errors.port %}
				{% endif %}
			</div>

			<div id="host-field" class="item field">
				<label for="host">Host Name</label>
				<div class="input-wrapper"><input id="host" name="host" type="text" value="{emailSettings.host}" /></div>
				{% if emailSettings.errors.host %}
					{% include "_includes/error_list" errors=emailSettings.errors.host %}
				{% endif %}
			</div>

			<div id="timeout-field" class="item field">
				<label for="timeout">Timeout</label>
				<input id="timeout" name="timeout" class="input" type="text" value="{% if emailSettings.timeout %}{emailSettings.timeout}{% else %}30{% endif %}" size="5" />
				{% if emailSettings.errors.timeout %}
					{% include "_includes/error_list" errors=emailSettings.errors.timeout %}
				{% endif %}
			</div>

			<div id="smtpAuth-field" class="item field">
				<label for="smtpAuth">Use SMTP Authentication?</label>
				<div>{% include "_includes/lightswitch" name="smtpAuth" on=emailSettings.smtpAuth toggle="#smtp-auth-credentials" %}</div>
				{% if emailSettings.errors.smtpAuth %}
					{% include "_includes/error_list" errors=emailSettings.errors.smtpAuth %}
				{% endif %}

				<div id="smtp-auth-credentials" class="nested">
					<div id="smtp-username-field" class="field">
						<label for="smtp-username">Username</label>
						<div class="input-wrapper"><input id="smtp-username" name="smtp_username" type="text" value="{emailSettings.username}" /></div>
						{% if emailSettings.protocol == 'Smtp' && emailSettings.errors.username %}
							{% include "_includes/error_list" errors=emailSettings.errors.username %}
						{% endif %}
					</div>
					<div id="smtp-password-field" class="field">
						<label for="smtp-password">Password</label>
						<div class="input-wrapper password"><input id="smtp-password" class="password" name="smtp_password" type="password" value="{emailSettings.password}" /></div>
						{% if emailSettings.protocol == 'Smtp' && emailSettings.errors.password %}
							{% include "_includes/error_list" errors=emailSettings.errors.password %}
						{% endif %}
					</div>
				</div>
			</div>
			<div id="smtpKeepAlive-field" class="item field">
				<label for="smtpKeepAlive">Use SMTP Keep Alive?</label>
				{% include "_includes/lightswitch" name="smtpKeepAlive" on=emailSettings.smtpKeepAlive %}
				{% if emailSettings.errors.smtpKeepAlive %}
					{% include "_includes/error_list" errors=emailSettings.errors.smtpKeepAlive %}
				{% endif %}
			</div>
			<div id="smtpSecureTransportType-field" class="item field">
				<label for="smtpSecureTransportType">SMTP Secure Transport Type</label>
				{% include "_includes/pill" name="smtpSecureTransportType" options="none:None,ssl:SSL,tls:TLS" default="none" value=emailSettings.smtpSecureTransportType %}
				{% if emailSettings.errors.smtpSecureTransportType %}
					{% include "_includes/error_list" errors=emailSettings.errors.smtpSecureTransportType %}
				{% endif %}
			</div>
		</div>

		<input class="btn big submit" type="submit" value="Save Email Settings" />
	</form>
{% endregion %}

{% region "scripts" %}
	{% include "_includes/js_include" file="email.js" %}
{% endregion %}
