{layout "settings/_layouts/settings" pageTitle="System Info"}

{if !emailSettings}
	{set emailSettings = email.emailSettings}
{/if}

{region "main"}
	<h2>Email settings</h2>

	<form method="post" action="">
		<input type="hidden" name="action" value="settings/saveemailsettings" />

		<div id="email-settings" class="pane">
			<div class="body">
				<div class="item field">
					<label for="emailAddress">System Email Address</label>
					<p>This is the email address Blocks will use when sending email.</p>
					<div class="input-wrapper"><input id="emailAddress" name="emailAddress" type="text" value="{:emailSettings.emailAddress}" /></div>
					{if emailSettings.errors.emailAddress}
						{include "_includes/error_list" errors=emailSettings.errors.emailAddress}
					{/if}
				</div>
				<div class="item field">
					<label for="senderName">Sender Name</label>
					<p>This is the “From” name Blocks will use when sending email.</p>
					<div class="input-wrapper"><input id="senderName" name="senderName" type="text" value="{:emailSettings.senderName}" /></div>
					{if emailSettings.errors.senderName}
						{include "_includes/error_list" errors=emailSettings.errors.senderName}
					{/if}
				</div>
				<div class="item field">
					<label for="protocol">Email Protocol</label>
					<p>This is the protocol Blocks will use to send email.</p>
					<div>
						<select id="protocol" name="protocol">
							<option value="PhpMail" {if emailSettings.protocol == 'PhpMail'}selected{/if}>PHP Mail</option>
							<option value="Sendmail" {if emailSettings.protocol == 'Sendmail'}selected{/if}>Sendmail</option>
							<option value="Smtp" {if emailSettings.protocol == 'Smtp'}selected{/if}>SMTP</option>
							<option value="GmailSmtp" {if emailSettings.protocol == 'GmailSmtp'}selected{/if}>Gmail SMTP</option>
							<option value="Pop" {if emailSettings.protocol == 'Pop'}selected{/if}>POP before SMTP</option>
						</select>
					</div>
				</div>
			</div>
		</div>

		<div id="hidden-fields" style="display: none">
			<div id="username-field" class="item field">
				<label for="username">Username</label>
				<div class="input-wrapper"><input id="username" name="username" type="text" value="{:emailSettings.username}" /></div>
				{if emailSettings.protocol != 'Smtp' && emailSettings.errors.username}
					{include "_includes/error_list" errors=emailSettings.errors.username}
				{/if}
			</div>
			<div id="password-field" class="item field">
				<label for="password">Password</label>
				<div class="input-wrapper password"><input id="password" class="password" name="password" type="password" value="{:emailSettings.password}" /></div>
				{if emailSettings.protocol != 'Smtp' && emailSettings.errors.password}
					{include "_includes/error_list" errors=emailSettings.errors.password}
				{/if}
			</div>
			
			<div id="port-field" class="item field">
				<label for="port">Port</label>
				<input id="port" name="port" class="input" type="text" value="{if emailSettings.port}{:emailSettings.port}{else}25{/if}" size="5" />
				{if emailSettings.errors.port}
					{include "_includes/error_list" errors=emailSettings.errors.port}
				{/if}
			</div>

			<div id="host-field" class="item field">
				<label for="host">Host Name</label>
				<div class="input-wrapper"><input id="host" name="host" type="text" value="{:emailSettings.host}" /></div>
				{if emailSettings.errors.host}
					{include "_includes/error_list" errors=emailSettings.errors.host}
				{/if}
			</div>

			<div id="timeout-field" class="item field">
				<label for="timeout">Timeout</label>
				<input id="timeout" name="timeout" class="input" type="text" value="{if emailSettings.timeout}{:emailSettings.timeout}{else}30{/if}" size="5" />
				{if emailSettings.errors.timeout}
					{include "_includes/error_list" errors=emailSettings.errors.timeout}
				{/if}
			</div>

			<div id="smtpAuth-field" class="item field">
				<div class="left">
					<label for="smtpAuth">Use SMTP Authentication?</label>
				</div>
				<div class="right">
					<div>{include "_includes/lightswitch" name="smtpAuth" on=emailSettings.smtpAuth toggle="#smtpAuthCredentials-field"}</div>
				</div>
				<div class="clear"></div>
				{if emailSettings.errors.smtpAuth}
					{include "_includes/error_list" errors=emailSettings.errors.smtpAuth}
				{/if}
			</div>

			<div id="smtpAuthCredentials-field" class="nested-items" {if !emailSettings.smtpAuth}style="height:0"{/if}>
				<div id="smtp-username-field" class="item field">
					<label for="smtp-username">Username</label>
					<div class="input-wrapper"><input id="smtp-username" name="smtp_username" type="text" value="{:emailSettings.username}" /></div>
					{if emailSettings.protocol == 'Smtp' && emailSettings.errors.username}
						{include "_includes/error_list" errors=emailSettings.errors.username}
					{/if}
				</div>
				<div id="smtp-password-field" class="item field">
					<label for="smtp-password">Password</label>
					<div class="input-wrapper password"><input id="smtp-password" class="password" name="smtp_password" type="password" value="{:emailSettings.password}" /></div>
					{if emailSettings.protocol == 'Smtp' && emailSettings.errors.password}
						{include "_includes/error_list" errors=emailSettings.errors.password}
					{/if}
				</div>
			</div>

			<div id="smtpKeepAlive-field" class="item field">
				<div class="left">
					<label for="smtpKeepAlive">Use SMTP Keep Alive?</label>
				</div>
				<div class="right">
					{include "_includes/lightswitch" name="smtpKeepAlive" on=emailSettings.smtpKeepAlive}
				</div>
				<div class="clear"></div>
				{if emailSettings.errors.smtpKeepAlive}
					{include "_includes/error_list" errors=emailSettings.errors.smtpKeepAlive}
				{/if}
			</div>
			<div id="smtpSecureTransportType-field" class="item field">
				<div class="left">
					<label for="smtpSecureTransportType" style="margin-top:2px">SMTP Secure Transport Type</label>
				</div>
				<div class="right">
					{include "_includes/pill" name="smtpSecureTransportType" options="none:None,ssl:SSL,tls:TLS" default="none" value=emailSettings.smtpSecureTransportType}
				</div>
				<div class="clear"></div>
				{if emailSettings.errors.smtpSecureTransportType}
					{include "_includes/error_list" errors=emailSettings.errors.smtpSecureTransportType}
				{/if}
			</div>
		</div>

		<input class="btn big submit" type="submit" value="Save Email Settings" />
	</form>
{/region}

{region "scripts"}
	{include "_includes/js_include" file="email.js"}
{/region}
