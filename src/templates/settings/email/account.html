{layout "settings/email/_layout" title="Account Settings"}


{if !settings}
	{set settings = blx.settings.email}
{/if}


{region "settings"}

	<form method="post" action="">
		<input type="hidden" name="action" value="settings/saveemailsettings">
		<input type="hidden" name="redirect" value="settings">

		<div class="field">
			<div class="heading">
				<h3><label for="emailAddress">System Email Address</label></h3>
				<p>The email address Blocks will use when sending email.</p>
			</div>
			<input id="emailAddress" name="emailAddress" class="text" type="text" value="{:settings.emailAddress}">
			{if settings.errors.emailAddress}
				{include "_includes/error_list" errors=settings.errors.emailAddress}
			{/if}
		</div>
		<div class="field">
			<div class="heading">
				<h3><label for="senderName">Sender Name</label></h3>
				<p>The “From” name Blocks will use when sending email.</p>
			</div>
			<input id="senderName" name="senderName" class="text" type="text" value="{:settings.senderName}">
			{if settings.errors.senderName}
				{include "_includes/error_list" errors=settings.errors.senderName}
			{/if}
		</div>
		<div class="field" id="protocol-field">
			<div class="heading">
				<h3><label for="protocol">Protocol</label></h3>
				<p>The protocol Blocks will use to send email.</p>
			</div>
			<select id="protocol" name="protocol">
				<option value="PhpMail" {if settings.protocol == 'PhpMail'}selected{/if}>Php Mail</option>
				<option value="Sendmail" {if settings.protocol == 'Sendmail'}selected{/if}>Sendmail</option>
				<option value="Smtp" {if settings.protocol == 'Smtp'}selected{/if}>Smtp</option>
				<option value="GmailSmtp" {if settings.protocol == 'GmailSmtp'}selected{/if}>Gmail Smtp</option>
				<option value="Pop" {if settings.protocol == 'Pop'}selected{/if}>Pop before Smtp</option>
			</select>
		</div>

		<div id="hidden-fields" style="display: none">
			<div id="username-field" class="field">
				<div class="heading">
					<h3><label for="username">Username</label></h3>
				</div>
				<input id="username" name="username" class="text" type="text" value="{:settings.username}">
				{if settings.protocol != 'Smtp' && settings.errors.username}
					{include "_includes/error_list" errors=settings.errors.username}
				{/if}
			</div>
			<div id="password-field" class="field">
				<div class="heading">
					<h3><label for="password">Password</label></h3>
				</div>
				<input id="password" name="password" class="text" type="password" value="{:settings.password}">
				{if settings.protocol != 'Smtp' && settings.errors.password}
					{include "_includes/error_list" errors=settings.errors.password}
				{/if}
			</div>
			
			<div id="port-field" class="field">
				<div class="heading">
					<h3><label for="port">Port</label></h3>
				</div>
				<input id="port" name="port" class="text" type="text" value="{if settings.port}{:settings.port}{else}25{/if}" size="5">
				{if settings.errors.port}
					{include "_includes/error_list" errors=settings.errors.port}
				{/if}
			</div>

			<div id="host-field" class="field">
				<div class="heading">
					<h3><label for="host">Host Name</label></h3>
				</div>
				<input id="host" name="host" class="text" type="text" value="{:settings.host}">
				{if settings.errors.host}
					{include "_includes/error_list" errors=settings.errors.host}
				{/if}
			</div>

			<div id="timeout-field" class="field">
				<div class="heading">
					<h3><label for="timeout">Timeout</label></h3>
				</div>
				<input id="timeout" name="timeout" class="text" type="text" value="{if settings.timeout}{:settings.timeout}{else}30{/if}" size="5">
				{if settings.errors.timeout}
					{include "_includes/error_list" errors=settings.errors.timeout}
				{/if}
			</div>

			<div id="smtpAuth-field" class="field">
				<label>
					<input type="checkbox" name="smtpAuth" value="y" {if settings.smtpAuth}checked{/if} class="togglefields" data-target="smtpAuthCredentials-field">
					Use Smtp Authentication
				</label>
			</div>

			<div id="smtpAuthCredentials-field" class="nested-fields" {if !settings.smtpAuth}style="height:0"{/if}>
				<div id="smtp-username-field" class="field">
					<div class="heading">
						<h3><label for="smtp-username">Username</label></h3>
					</div>
					<input id="smtp-username" name="smtp_username" class="text" type="text" value="{:settings.username}">
					{if settings.protocol == 'Smtp' && settings.errors.username}
						{include "_includes/error_list" errors=settings.errors.username}
					{/if}
				</div>
				<div id="smtp-password-field" class="field">
					<div class="heading">
						<h3><label for="smtp-password">Password</label></h3>
					</div>
					<input id="smtp-password" name="smtp_password" class="text" type="password" value="{:settings.password}">
					{if settings.protocol == 'Smtp' && settings.errors.password}
						{include "_includes/error_list" errors=settings.errors.password}
					{/if}
				</div>
			</div>

			<div id="smtpKeepAlive-field" class="field">
				<label>
					<input type="checkbox" name="smtpKeepAlive" value="y" {if settings.smtpKeepAlive}checked{/if}>
					Use Smtp Keep Alive
				</label>
			</div>
			<div id="smtpSecureTransportType-field" class="field">
				<div class="heading">
					<h3><label for="smtpSecureTransportType">Smtp Secure Transport Type</label></h3>
				</div>
				{include "_includes/pill" name="smtpSecureTransportType" options="none:None,ssl:SSL,tls:TLS" default="none" value=settings.smtpSecureTransportType}
			</div>
		</div>

		<div class="buttons">
			<input class="btn submit" type="submit" value="Save">
			<a class="btn" href="{:blx.url.base}settings">Cancel</a>
		</div>
	</form>

{/region}


{region "scripts"}
	{include "_includes/js_include" file="email.js"}
{/region}
