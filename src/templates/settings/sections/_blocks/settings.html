<!-- BLOCKS ONLY -->
<!-- TARGET: blocks/app/templates/settings/blog/_blocksettings.html -->
<!-- end BLOCKS ONLY -->
{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

<!-- BLOCKSPRO ONLY -->
{% set section = blx.content.getSectionById(sectionId) %}
{% if not section %}{% exit 404 %}{% endif %}
<!-- end BLOCKSPRO ONLY -->


{% if not block and blockId %}
	{% set block = blx.content.getEntryBlockById(blockId) %}
	{% if not block %}{% exit 404 %}{% endif %}
{% endif %}


{% if block.id %}
	{% set title = "{name} Settings"|t({ name: '<i>'~block.name|t~'</i>' }) %}
{% else %}
	{% set title = "Create a new entry block"|t %}
{% endif %}


{% set titlebar %}
	<h1>{{ title|raw }}</h1>
	<ul class="left">
		<!-- BLOCKS ONLY -->
		<li><a href="{{ url('settings/blog') }}" class="btn backbtn">{{ "Blog"|t }}</a></li>
		<!-- end BLOCKS ONLY -->
		<!-- BLOCKSPRO ONLY -->
		<li><a href="{{ url('settings/sections/' ~ section.id ~ '/blocks') }}" class="btn backbtn">{{ "{section} Entry Blocks"|t({ section: '<i>'~section.name|t~'</i>' })|raw }}</a></li>
		<!-- end BLOCKSPRO ONLY -->
	</ul>
{% endset %}


{% set content %}
	<form method="post" action="" class="centered">
		<input type="hidden" name="action" value="content/saveEntryBlock">
		<!-- BLOCKS ONLY -->
		<input type="hidden" name="redirect" value="settings/blog">
		<!-- end BLOCKS ONLY -->
		<!-- BLOCKSPRO ONLY -->
		<input type="hidden" name="redirect" value="settings/sections/{{ section.id }}/blocks">
		<input type="hidden" name="sectionId" value="{{ section.id }}">
		<!-- end BLOCKSPRO ONLY -->
		{% if block.id %}<input type="hidden" name="blockId" value="{{ block.id }}">{% endif %}

		{{ forms.textField({
			label: "Name"|t,
			instructions: "What this block will be called in the CP."|t,
			id: 'name',
			name: 'name',
			value: block.name,
			errors: block.errors.name,
			first: true,
			required: true,
			translatable: true
		}) }}

		{{ forms.textField({
			label: "Handle"|t,
			instructions: "How youâ€™ll refer to this block in the templates."|t,
			id: 'handle',
			class: 'code',
			name: 'handle',
			value: block.handle,
			errors: block.errors.handle,
			required: true,
		}) }}

		{{ forms.textareaField({
			label: "Instructions"|t,
			<!-- BLOCKS ONLY -->
			instructions: "Helper text to guide you when authoring an entry."|t,
			<!-- end BLOCKS ONLY -->
			<!-- BLOCKSPRO ONLY -->
			instructions: "Helper text to guide the author."|t,
			<!-- end BLOCKSPRO ONLY -->
			id: 'instructions',
			name: 'instructions',
			value: block.instructions,
			errors: block.errors.instructions,
			translatable: true
		}) }}

		<!-- BLOCKSPRO ONLY -->
		{{ forms.checkboxField({
			label: "This entry block is required"|t,
			name: 'required',
			checked: block.required
		}) }}

		{% if blx.systemSettings.languages %}
			{{ forms.checkboxField({
				label: "This entry block is translatable"|t,
				name: 'translatable',
				checked: block.translatable
			}) }}
		{% endif %}
		<!-- end BLOCKSPRO ONLY -->

		{% set blocks = blx.blocks.getAllBlocks %}
		{% set blockClass = block ? block.class : 'PlainText' %}

		{{ forms.selectField({
			label: "Type",
			instructions: "What type of block is this?"|t,
			id: 'class',
			name: 'class',
			options: blocks,
			value: blockClass,
			toggle: true
		}) }}

		{% for _block in blocks %}
			{% set isCurrent = (_block.classHandle == blockClass) %}
			{% set settings = _block.settings(isCurrent ? block.settings : null) %}

			{% if settings %}
				<div id="{{ _block.classHandle }}" {% if not isCurrent %}style="display: none"{% endif %}>
					<hr>
					{% set namespace = 'types[' ~ _block.classHandle ~ ']' %}
					{{- settings|ns(namespace)|raw -}}
					<hr>
				</div>
			{% endif %}
		{% endfor %}

		<div class="buttons">
			<input type="submit" class="btn submit" value="{{ 'Save'|t }}">
		</div>
	</form>
{% endset %}


{% set scripts %}
	<script type="text/javascript">
		{% if not block.handle %}new Blocks.ui.HandleGenerator('#name', '#handle');{% endif %}
	</script>
{% endset %}
