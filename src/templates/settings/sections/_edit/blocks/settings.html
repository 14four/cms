{% extends "_layouts/cp" %}


{% if blx.hasPackage('PublishPro') %}
	{% if sectionId is not defined %}{% exit 404 %}{% endif %}
	{% set section = blx.sections.id(sectionId).first %}
	{% if not section %}{% exit 404 %}{% endif %}

	{% set crumbs = [
		{ label: "Settings"|t, url: url('settings') },
		{ label: "Sections"|t, url: url('settings/sections') },
		{ label: section.name|t, url: url('settings/sections/'~section.id) },
		{ label: "Blocks"|t, url: url('settings/sections/'~section.id~'/blocks') }
	] %}
{% else %}
	{% set crumbs = [
		{ label: "Settings"|t, url: url('settings') },
		{ label: "Blog"|t, url: url('settings/blog') },
		{ label: "Blocks"|t, url: url('settings/blog') }
	] %}
{% endif %}


{% if block is not defined and blockId is defined %}
	{% set block = blx.entryBlocks.getBlockById(blockId) %}
	{% if not block %}{% exit 404 %}{% endif %}
{% endif %}


{% set isNewBlock = (block is not defined or not block.id) %}


{% if isNewBlock %}
	{% set title = "Create a new entry block"|t %}
{% else %}
	{% set title = block.name|t %}
{% endif %}


{% set content %}
	<form method="post" action="" accept-charset="UTF-8">
		{% if blx.hasPackage('PublishPro') %}
			<input type="hidden" name="action" value="sections/saveBlock">
			<input type="hidden" name="redirect" value="settings/sections/{{ section.id }}/blocks">
			<input type="hidden" name="sectionId" value="{{ section.id }}">
		{% else %}
			<input type="hidden" name="action" value="entries/saveBlock">
			<input type="hidden" name="redirect" value="settings/blog">
		{% endif %}

		{% if not isNewBlock %}
			<input type="hidden" name="blockId" value="{{ block.id }}">
		{% endif %}

		{% include "_includes/blocksettings" with { block: (block is defined ? block : null), canBeTranslatable: true } only %}

		<div class="buttons">
			<input type="submit" class="btn submit" value="{{ 'Save'|t }}">
		</div>
	</form>
{% endset %}
