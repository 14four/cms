{% if not sectionPackage and sectionId %}
	{% set sectionPackage = blx.content.getSectionById(sectionId) %}
	{% if not sectionPackage %}{% exit 404 %}{% endif %}
{% endif %}


{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}


{% if sectionPackage.id %}
	{% set title = "{name} Settings"|t({ name: '<i>'~sectionPackage.name|t~'</i>' }) %}
{% else %}
	{% set title = "Create a new section"|t %}
{% endif %}


{% set titlebar %}
	<h1>{{ title|raw }}</h1>
	<ul class="left">
		<li><a href="{{ url('settings/sections') }}" class="backbtn">{{ "Sections"|t }}</a></li>
	</ul>
{% endset %}


{% set content %}
	<form method="post" action="" class="centered">
		<input type="hidden" name="action" value="content/saveSection">
		<input type="hidden" name="redirect" value="settings/sections">
		{% if sectionPackage.id %}<input type="hidden" name="sectionId" value="{{ sectionPackage.id }}">{% endif %}


		{{ forms.textField({
			label: "Name"|t,
			instructions: "What this section will be called in the CP."|t,
			id: 'name',
			name: 'name',
			value: sectionPackage.name,
			errors: sectionPackage.errors.name,
			first: true,
			required: true,
			translatable: true
		}) }}

		{{ forms.textField({
			label: "Handle"|t,
			instructions: "How you’ll refer to this section in the templates."|t,
			id: 'handle',
			class: 'code',
			name: 'handle',
			value: sectionPackage.handle,
			errors: sectionPackage.errors.handle,
			required: true
		}) }}

		{{ forms.checkboxField({
			label: "Entries in this section have their own URLs"|t,
			name: 'hasUrls',
			checked: sectionPackage.hasUrls,
			toggle: 'has-urls-setting'
		}) }}

		<div id="has-urls-setting" class="nested-fields{% if not sectionPackage.hasUrls %} hidden{% endif %}">

			<hr>

			{{ forms.textField({
				label: "Entry URL Format"|t,
				instructions: "What the entry URLs should look like."|t,
				id: 'urlFormat',
				class: 'code',
				name: 'urlFormat',
				value: sectionPackage.urlFormat,
				errors: sectionPackage.errors.urlFormat
			}) }}

			{{ forms.textField({
				label: "Entry Template"|t,
				instructions: "Which template to use when an entry’s URL is requested."|t,
				id: 'template',
				name: 'template',
				value: sectionPackage.template,
				errors: sectionPackage.errors.template
			}) }}

			<hr>

		</div>

		<div class="buttons">
			<input type="submit" class="btn submit" value="{{ 'Save'|t }}">
		</div>
	</form>
{% endset %}


{% set js %}
	{% if not sectionPackage.handle %}new Blocks.ui.HandleGenerator('#name', '#handle');{% endif %}
	{% if not sectionPackage.urlFormat %}new Blocks.ui.EntryUrlFormatGenerator('#name', '#urlFormat');{% endif %}
{% endset %}
{% includeJs js %}
