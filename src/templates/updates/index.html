{% set title = "Updates" %}
{% extends "_layouts/cp" %}


{% block styles %}
	<style type="text/css">
		h3.critical { color: #8a1f11; }
		.notes { display: none; }
		.cta { position: absolute; top: 15px; right: 15px; }
		.cta .manual { margin-top: 5px; }
	</style>
{% endblock %}


{% block main %}
	<header class="titlebar">
		<h1>Updates</h1>
	</header>

	{% set problems = blx.updates.unwritabledirectories %}
	{% if not problems %}
		<div id="checking">
			Checking for updatesâ€¦
		</div>
		<script type="text/javascript">
			// Keep the spinner vertically centered
			function centerSpinner()
			{
				var top = ((window.innerHeight-48) / 2) - 44;
				document.getElementById('checking').style.top = top+'px';
			}
			centerSpinner();
		</script>

		<div id="updates"></div>
	{% else %}
		<p>Blocks will have a problem writing to the following {% if problems|length == 1 %}directory{% else %}directories{% endif %}:</p>
		<ul>
			{% for problem in problems %}
				<li>{{ problem }}<li>
			{% endfor %}
		</ul>

		<br>

		<div>
			<p><strong>For automatic updates to work, at least two criteria must be satisfied:</strong></p>
			<p><strong>(a) File ownership:</strong> All of your Blocks files must be owned by the user under which your web server executes. In other words, the owner of your Blocks files must match the user under which your web server executes. The web server user (named "apache", "web", "www", "nobody", or some such) is not necessarily the owner of your Blocks files. Typically, Blocks files are owned by the ftp user which uploaded the original files.</p>
			<p><strong>(b) File permissions:</strong> All of your Blocks files must be either owner writable by, or group writable by, the user under which your Apache server executes.</p>
			<p>On shared hosts, Blocks files should specifically NOT be owned by the web server. If more than one user owns different files in the install (because of edits made by deleting and re-uploading of files via different accounts, for example), the file permissions need to be group writable (for example, 775 and 664 rather then the default 755 and 644). File permissions (in general) should be adjusted as appropriate for the server environment.</p>
		</div>
	{% endif %}
{% endblock %}

{% block scripts %}
	{% include "_includes/js_include" with {'file': "updates.js"} %}
{% endblock %}
