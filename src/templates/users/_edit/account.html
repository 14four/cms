{% extends "users/_edit/layout" %}
{% import "_includes/forms" as forms %}
{% set pageTitle = "Account Settings"|t %}


<!-- BLOCKS ONLY -->
{% if not user %}
	{% set user = blx.accounts.current %}
{% endif %}
<!-- end BLOCKS ONLY -->
<!-- BLOCKSPRO ONLY -->
{% if not user and userId %}
	{% set user = blx.accounts.getById(userId) %}
	{% if not user %}{% exit 404 %}{% endif %}
{% endif %}
<!-- end BLOCKSPRO ONLY -->


{% set settings %}
	{% if user.id %}
		<h2>{{ pageTitle }}</h2>
	{% endif %}

	<form method="post" action="">
		<input type="hidden" name="action" value="accounts/saveAccountSettings">
		{% if user.id %}<input type="hidden" name="userId" value="{{ user.id }}">{% endif %}

		{{ forms.textField({
			label: "Username"|t,
			id: 'username',
			name: 'username',
			value: user.username,
			required: true,
			errors: user.errors.username
		}) }}

		{{ forms.textField({
			label: "Email"|t,
			id: 'email',
			name: 'email',
			value: user.email,
			required: true,
			errors: user.errors.email
		}) }}

		{% if not user.id and blx.accounts.current.admin %}
			{{ forms.checkboxField({
				label: "Require verification"|t,
				name: 'requireVerification',
				checked: blx.request.post('requireVerification')
			}) }}
		{% endif %}

		{% if user.isCurrent or blx.accounts.current.admin %}
			{{ forms.passwordField({
				label: "Password"|t,
				instructions: (user.id ? "Leave blank to keep password unchanged."|t : null),
				id: 'password',
				name: 'password',
				errors: (passwordForm.errors.password)
			}) }}

			{% if not user.isCurrent %}
				{{ forms.checkboxField({
					label: "Require a password reset on next login"|t,
					name: 'requirePasswordReset',
					checked: (not user or blx.request.post('requirePasswordReset'))
				}) }}
			{% endif %}
		{% endif %}

		{{ forms.selectField({
			label: "Email Format"|t,
			id: 'emailFormat',
			name: 'emailFormat',
			options: { text: "Plain Text"|t, html: "HTML"|t },
			value: user.emailFormat,
			default: 'html'
		}) }}

		<!-- BLOCKSPRO ONLY -->
		{% set languageInput %}
			<div class="select">
				<select id="language" name="language">
					{% set userLanguage = user ? user.language : blx.app.language %}
					{% for language in blx.localization.translatedLanguages %}
						<option value="{{ language }}" {% if language == userLanguage %}selected{% endif %}>{{ blx.localization.localeName(language, language) }}</option>
					{% endfor %}
				</select>
			</div>
		{% endset %}
		{{ forms.field({ label: "Language"|t, id: 'language' }, languageInput) }}
		<!-- end BLOCKSPRO ONLY -->

		<input type="submit" class="btn submit" value="{{ 'Save'|t }}">

	</form>
{% endset %}
