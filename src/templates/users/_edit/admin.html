{% extends "users/_edit/layout" %}
{% import "_includes/forms" as forms %}
{% set pageTitle = "Administration"|t %}


{% if not user and userId %}
	{% set user = blx.accounts.getUserById(userId) %}
{% endif %}


{% set settings %}
	<form method="post" action="">
		<input type="hidden" name="action" value="accounts/saveAdminSettings">
		<input type="hidden" name="redirect" value="users/{{ user.id }}/admin">
		<input type="hidden" name="userId" value="{{ user.id }}">

		{{ forms.checkboxField({
			label: "This is an admin account"|t,
			name: 'admin',
			checked: user.admin
		}) }}

		<h3>User Groups</h3>

		{% set userGroupIds = user.groupIds %}

		{% for group in blx.accounts.userGroups %}
			<div class="field">
				{{ forms.checkbox({
					label: group.name,
					name: 'groups[]',
					value: group.id,
					checked: (group.id in userGroupIds)
				}) }}
			</div>
		{% endfor %}

		<div class="buttons">
			<input type="submit" class="btn submit" value="{{ 'Save'|t }}">
		</div>
	</form>

	<hr>

	<form method="post" action="">
		<input type="hidden" name="userId" value="{{ user.id }}">

		<div class="field">
			<div class="heading">
				<h3>{{ "Account Status"|t }}</h3>
			</div>

			{% if user.status == 'pending' %}

				<div class="status"></div> {{ "Pending Verification"|t }}  
				<input type="button" class="btn formsubmit" value="{{ 'Send Verification Email'|t }}" data-action="accounts/sendVerificationEmail">
				<input type="button" class="btn formsubmit" value="{{ 'Activate'|t }}" data-action="accounts/activateUser">

			{% elseif user.status == 'locked' %}

				<div class="status pending"></div> {% if blx.config.failedPasswordMode == 'cooldown' %}{{ "Temporarily"|t }}{% endif %} {{ "Locked"|t }}  
				<input type="button" class="btn formsubmit" value="{{ 'Unlock'|t }}" data-action="accounts/unlockUser">

			{% elseif user.status == 'suspended' %}

				<div class="status off"></div> {{ "Suspended"|t }}  
				<input type="submit" class="btn formsubmit" value="{{ 'Unsuspend'|t }}" data-action="accounts/unsuspendUser">

			{% else %}

				<div class="status on"></div> {{ "Active"|t }}

			{% endif %}
		</div>

		{% if not user.isCurrent %}
			<div class="field">
				<h3>{{ "Account Actions"|t }}</h3>

				{% if user.status != 'suspended' %}
					<input type="button" class="btn formsubmit" value="{{ 'Suspend'|t }}" data-action="accounts/suspendUser">
				{% endif %}

				<input class="btn" type="submit" name="delete" value="{{ 'Delete'|t }}" data-action="accounts/deleteUser">
			</div>
		{% endif %}
	</form>
{% endset %}
