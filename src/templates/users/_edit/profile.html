{% extends "users/_edit/layout" %}
{% import "_includes/forms" as forms %}
{% set pageTitle = "Profile"|t %}


{% if not user %}
	{% set user = blx.accounts.getUserById(userId) %}
	{% if not user %}{% exit 404 %}{% endif %}
{% endif %}


{% if not profile %}
	{% set profile = user.profile %}
{% endif %}


{% set content %}
	<form method="post" action="" class="centered">
		<input type="hidden" name="action" value="accounts/saveProfile">
		<input type="hidden" name="userId" value="{{ user.id }}">

		{{ forms.textField({
			first: true,
			label: "First Name"|t,
			id: 'firstName',
			name: 'firstName',
			value: profile.firstName,
			errors: profile.errors.firstName
		}) }}

		{{ forms.textField({
			label: "Last Name"|t,
			id: 'lastName',
			name: 'lastName',
			value: profile.lastName,
			errors: profile.errors.lastName
		}) }}

		{{ forms.fileField({
			label: "Avatar"|t,
			id: 'avatar',
			name: 'avatar',
			errors: profile.errors.avatar
		}) }}

		{% for block in blx.accounts.userProfileBlocks %}
			{% set blockType = blx.blocks.populateBlockType(block) %}
			{% set name = 'block'~block.id %}
			{% set value = profile.blocks[name] %}
			{% set errors = profile.blockErrors[block.handle] %}
			{% set input = blockType.input(name, value) %}

			{{ forms.field({
				label: block.name,
				instructions: block.instructions,
				id: block.handle,
				errors: errors
			}, input)|ns('blocks')|raw }}
		{% endfor %}

		<input type="submit" class="btn submit" value="{{ 'Save'|t }}">

	</form>

{% endset %}
