!function(t){Craft.Installer=Garnish.Base.extend({$bg:null,$screens:null,$dots:null,$currentScreen:null,$currentDot:null,$accountSubmitBtn:null,$siteSubmitBtn:null,loading:!1,init:function(){this.$bg=t("#bg"),this.$screens=t("#screens").children(),this.$dots=t();for(var e=0;e<this.$screens.length;e++)this.$dots=this.$dots.add(t("<div/>").appendTo(t("#dots")));this.addListener(t("#beginbtn"),"activate","showAccountScreen")},showAccountScreen:function(e){new Garnish.Modal(t("#install-modal").removeClass("hidden"),{shadeClass:""}),this.showScreen(1),this.$accountSubmitBtn=t("#accountsubmit"),this.addListener(this.$accountSubmitBtn,"activate","validateAccount"),this.addListener(t("#accountform"),"submit","validateAccount")},validateAccount:function(e){e.preventDefault();var s=["username","email","password"];this.validate("account",s,t.proxy(this,"showSiteScreen"))},showSiteScreen:function(){this.showScreen(2),this.$siteSubmitBtn=t("#sitesubmit"),this.addListener(this.$siteSubmitBtn,"activate","validateSite"),this.addListener(t("#siteform"),"submit","validateSite")},validateSite:function(e){e.preventDefault();var s=["systemName","siteUrl","siteLanguage"];this.validate("site",s,t.proxy(this,"showInstallScreen"))},showInstallScreen:function(){this.showScreen(3);for(var e=["username","email","password","systemName","siteUrl","siteLanguage"],s={},n=0;n<e.length;n++){var i=e[n],r=t("#"+i);s[i]=Garnish.getInputPostVal(r)}Craft.postActionRequest("install/install",s,t.proxy(this,"allDone"),{complete:t.noop})},allDone:function(e,s){t("#spinner").remove();var n=this.$currentScreen.find("h1:first");"success"===s&&e.success?(n.text(Craft.t("app","Craft is installed! ðŸŽ‰")),setTimeout(function(){window.location.href=Craft.getUrl("dashboard")},1e3)):(n.text("Install failed ðŸ˜ž"),t("<p/>",{text:"Please check your logs for more info."}).insertAfter(n))},showScreen:function(e){this.$currentScreen&&(this.$currentScreen.addClass("hidden"),this.$currentDot.removeClass("sel")),this.$currentScreen=this.$screens.eq(e-1).removeClass("hidden"),this.$currentDot=this.$dots.eq(e-1).addClass("sel"),1===e?setTimeout(t.proxy(this,"focusFirstInput"),100):this.focusFirstInput()},validate:function(e,s,n){if(!this.loading){this.loading=!0,t("#"+e+"form").find(".errors").remove();var i=this["$"+e+"SubmitBtn"];i.addClass("sel loading");for(var r="install/validate-"+e,a={},o=0;o<s.length;o++){var l=s[o],c=t("#"+l);a[l]=Garnish.getInputPostVal(c)}Craft.postActionRequest(r,a,t.proxy(function(e,s){if(this.loading=!1,i.removeClass("sel loading"),"success"===s)if(e.validates)n();else{for(var r in e.errors)if(e.errors.hasOwnProperty(r)){for(var a=e.errors[r],o=t("#"+r),l=o.closest(".field"),c=t('<ul class="errors"/>').appendTo(l),u=0;u<a.length;u++){var h=a[u];t("<li>"+h+"</li>").appendTo(c)}o.is(":focus")||(o.addClass("error"),t.proxy(function(t){this.addListener(t,"focus",function(){t.removeClass("error"),this.removeListener(t,"focus")})},this)(o))}Garnish.shake(this.$currentScreen)}},this))}},focusFirstInput:function(){this.$currentScreen.find("input[type=text]:first").focus()}}),Garnish.$win.on("load",function(){Craft.installer=new Craft.Installer})}(jQuery);
//# sourceMappingURL=install.min.js.map