!function(e){Craft.PluginManager=Garnish.Base.extend({init:function(){Craft.postActionRequest("app/get-plugin-license-info",function(n,s){if("success"===s)for(var i in n)n.hasOwnProperty(i)&&new t(e("#plugin-"+i)).update(n[i])})}});var t=Garnish.Base.extend({$row:null,$keyContainer:null,$keyInput:null,$spinner:null,handle:null,updateTimeout:null,init:function(e){this.$row=e,this.$keyContainer=e.find(".license-key"),this.$keyInput=this.$keyContainer.find("input.text").removeAttr("readonly"),this.$spinner=e.find(".spinner"),this.handle=this.$row.data("handle"),this.addListener(this.$keyInput,"focus","onKeyFocus"),this.addListener(this.$keyInput,"textchange","onKeyChange")},getKey:function(){return this.$keyInput.val().replace(/\-/g,"").toUpperCase()},onKeyFocus:function(){this.$keyInput.select()},onKeyChange:function(){this.updateTimeout&&clearTimeout(this.updateTimeout);var t=this.getKey();if(0===t.length||24===t.length){var n=t.replace(/.{4}/g,"$&-").substr(0,29).toUpperCase();this.$keyInput.val(n).data("garnish-textchange-value",n),this.updateTimeout=setTimeout(e.proxy(this,"updateLicenseStatus"),100)}},updateLicenseStatus:function(){this.$spinner.removeClass("hidden"),Craft.postActionRequest("app/update-plugin-license",{handle:this.handle,key:this.getKey()},e.proxy(function(e,t){this.$spinner.addClass("hidden"),"success"===t&&this.update(e)},this))},update:function(t){var n=this.$row.find(".license-key-status");if("valid"==t.licenseKeyStatus||t.hasIssues){var s=e("<span/>",{class:"license-key-status "+t.licenseKeyStatus});n.length?n.replaceWith(s):s.appendTo(this.$row.find(".icon"))}else n.length&&n.remove();var i=t.licenseKey||"unknown"!==t.licenseKeyStatus;i?this.$keyContainer.removeClass("hidden"):this.$keyContainer.addClass("hidden"),i&&t.hasIssues?this.$keyInput.addClass("error"):this.$keyInput.removeClass("error");var a=this.$row.find("p.error");if(i&&t.licenseStatusMessage){var r=e("<p/>",{class:"error",html:t.licenseStatusMessage});a.length?a.replaceWith(r):r.insertAfter(this.$row.find(".license-key"))}else a.remove()}})}(jQuery);
//# sourceMappingURL=PluginManager.min.js.map